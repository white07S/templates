<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: memory_layer_flow Pages: 1 -->
<svg width="2700pt" height="650pt"
 viewBox="0.00 0.00 2700.00 650.43" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 646.43)">
<title>memory_layer_flow</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-646.43 2696,-646.43 2696,4 -4,4"/>
<g id="clust1" class="cluster">
<title>cluster_api</title>
<path fill="none" stroke="black" d="M20,-291.43C20,-291.43 341,-291.43 341,-291.43 347,-291.43 353,-297.43 353,-303.43 353,-303.43 353,-352.43 353,-352.43 353,-358.43 347,-364.43 341,-364.43 341,-364.43 20,-364.43 20,-364.43 14,-364.43 8,-358.43 8,-352.43 8,-352.43 8,-303.43 8,-303.43 8,-297.43 14,-291.43 20,-291.43"/>
<text text-anchor="middle" x="180.5" y="-350.83" font-family="Times,serif" font-size="12.00">API / Chat Processor</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_session</title>
<path fill="none" stroke="black" d="M1992,-507.43C1992,-507.43 2664.5,-507.43 2664.5,-507.43 2670.5,-507.43 2676.5,-513.43 2676.5,-519.43 2676.5,-519.43 2676.5,-622.43 2676.5,-622.43 2676.5,-628.43 2670.5,-634.43 2664.5,-634.43 2664.5,-634.43 1992,-634.43 1992,-634.43 1986,-634.43 1980,-628.43 1980,-622.43 1980,-622.43 1980,-519.43 1980,-519.43 1980,-513.43 1986,-507.43 1992,-507.43"/>
<text text-anchor="middle" x="2328.25" y="-620.83" font-family="Times,serif" font-size="12.00">Session Memory Layer</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_user</title>
<path fill="none" stroke="black" d="M1195.5,-291.43C1195.5,-291.43 1833,-291.43 1833,-291.43 1839,-291.43 1845,-297.43 1845,-303.43 1845,-303.43 1845,-352.43 1845,-352.43 1845,-358.43 1839,-364.43 1833,-364.43 1833,-364.43 1195.5,-364.43 1195.5,-364.43 1189.5,-364.43 1183.5,-358.43 1183.5,-352.43 1183.5,-352.43 1183.5,-303.43 1183.5,-303.43 1183.5,-297.43 1189.5,-291.43 1195.5,-291.43"/>
<text text-anchor="middle" x="1514.25" y="-350.83" font-family="Times,serif" font-size="12.00">User Memory Layer</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_retrieval</title>
<path fill="none" stroke="black" d="M1672,-372.43C1672,-372.43 2207,-372.43 2207,-372.43 2213,-372.43 2219,-378.43 2219,-384.43 2219,-384.43 2219,-487.43 2219,-487.43 2219,-493.43 2213,-499.43 2207,-499.43 2207,-499.43 1672,-499.43 1672,-499.43 1666,-499.43 1660,-493.43 1660,-487.43 1660,-487.43 1660,-384.43 1660,-384.43 1660,-378.43 1666,-372.43 1672,-372.43"/>
<text text-anchor="middle" x="1939.5" y="-485.83" font-family="Times,serif" font-size="12.00">Retrieval</text>
</g>
<g id="clust5" class="cluster">
<title>cluster_index</title>
<path fill="none" stroke="black" d="M2525,-62.43C2525,-62.43 2672,-62.43 2672,-62.43 2678,-62.43 2684,-68.43 2684,-74.43 2684,-74.43 2684,-177.43 2684,-177.43 2684,-183.43 2678,-189.43 2672,-189.43 2672,-189.43 2525,-189.43 2525,-189.43 2519,-189.43 2513,-183.43 2513,-177.43 2513,-177.43 2513,-74.43 2513,-74.43 2513,-68.43 2519,-62.43 2525,-62.43"/>
<text text-anchor="middle" x="2598.5" y="-175.83" font-family="Times,serif" font-size="12.00">Indexes / Storage</text>
</g>
<g id="clust6" class="cluster">
<title>cluster_llm</title>
<path fill="none" stroke="black" d="M790.5,-30.43C790.5,-30.43 1793.5,-30.43 1793.5,-30.43 1799.5,-30.43 1805.5,-36.43 1805.5,-42.43 1805.5,-42.43 1805.5,-126.43 1805.5,-126.43 1805.5,-132.43 1799.5,-138.43 1793.5,-138.43 1793.5,-138.43 790.5,-138.43 790.5,-138.43 784.5,-138.43 778.5,-132.43 778.5,-126.43 778.5,-126.43 778.5,-42.43 778.5,-42.43 778.5,-36.43 784.5,-30.43 790.5,-30.43"/>
<text text-anchor="middle" x="1292" y="-124.83" font-family="Times,serif" font-size="12.00">LLM + Tools</text>
</g>
<g id="clust7" class="cluster">
<title>cluster_extraction</title>
<path fill="none" stroke="black" d="M746.5,-218.43C746.5,-218.43 953.5,-218.43 953.5,-218.43 959.5,-218.43 965.5,-224.43 965.5,-230.43 965.5,-230.43 965.5,-279.43 965.5,-279.43 965.5,-285.43 959.5,-291.43 953.5,-291.43 953.5,-291.43 746.5,-291.43 746.5,-291.43 740.5,-291.43 734.5,-285.43 734.5,-279.43 734.5,-279.43 734.5,-230.43 734.5,-230.43 734.5,-224.43 740.5,-218.43 746.5,-218.43"/>
<text text-anchor="middle" x="850" y="-277.83" font-family="Times,serif" font-size="12.00">Memory Extraction &amp; Compression</text>
</g>
<!-- ChatEndpoint -->
<g id="node1" class="node">
<title>ChatEndpoint</title>
<path fill="none" stroke="black" d="M105,-335.43C105,-335.43 28,-335.43 28,-335.43 22,-335.43 16,-329.43 16,-323.43 16,-323.43 16,-311.43 16,-311.43 16,-305.43 22,-299.43 28,-299.43 28,-299.43 105,-299.43 105,-299.43 111,-299.43 117,-305.43 117,-311.43 117,-311.43 117,-323.43 117,-323.43 117,-329.43 111,-335.43 105,-335.43"/>
<text text-anchor="middle" x="66.5" y="-314.63" font-family="Times,serif" font-size="11.00">/chat (FastAPI)</text>
</g>
<!-- ChatProcessor -->
<g id="node2" class="node">
<title>ChatProcessor</title>
<path fill="none" stroke="black" d="M333,-335.43C333,-335.43 166,-335.43 166,-335.43 160,-335.43 154,-329.43 154,-323.43 154,-323.43 154,-311.43 154,-311.43 154,-305.43 160,-299.43 166,-299.43 166,-299.43 333,-299.43 333,-299.43 339,-299.43 345,-305.43 345,-311.43 345,-311.43 345,-323.43 345,-323.43 345,-329.43 339,-335.43 333,-335.43"/>
<text text-anchor="middle" x="249.5" y="-320.63" font-family="Times,serif" font-size="11.00">ChatProcessor</text>
<text text-anchor="middle" x="249.5" y="-308.63" font-family="Times,serif" font-size="11.00">(build context, tool calls, LLM)</text>
</g>
<!-- ChatEndpoint&#45;&gt;ChatProcessor -->
<g id="edge1" class="edge">
<title>ChatEndpoint&#45;&gt;ChatProcessor</title>
<path fill="none" stroke="black" d="M117.44,-317.43C125.73,-317.43 134.58,-317.43 143.64,-317.43"/>
<polygon fill="black" stroke="black" points="143.93,-320.93 153.93,-317.43 143.93,-313.93 143.93,-320.93"/>
</g>
<!-- SessionMemory -->
<g id="node3" class="node">
<title>SessionMemory</title>
<path fill="none" stroke="black" d="M2216,-575.43C2216,-575.43 2000,-575.43 2000,-575.43 1994,-575.43 1988,-569.43 1988,-563.43 1988,-563.43 1988,-551.43 1988,-551.43 1988,-545.43 1994,-539.43 2000,-539.43 2000,-539.43 2216,-539.43 2216,-539.43 2222,-539.43 2228,-545.43 2228,-551.43 2228,-551.43 2228,-563.43 2228,-563.43 2228,-569.43 2222,-575.43 2216,-575.43"/>
<text text-anchor="middle" x="2108" y="-560.63" font-family="Times,serif" font-size="11.00">SessionMemory</text>
<text text-anchor="middle" x="2108" y="-548.63" font-family="Times,serif" font-size="11.00">(conversation_buffer, context_summary)</text>
</g>
<!-- ChatProcessor&#45;&gt;SessionMemory -->
<g id="edge2" class="edge">
<title>ChatProcessor&#45;&gt;SessionMemory</title>
<path fill="none" stroke="black" d="M275.3,-335.47C354.57,-391.28 610.55,-557.43 849,-557.43 849,-557.43 849,-557.43 1752.5,-557.43 1826.99,-557.43 1910.29,-557.43 1977.41,-557.43"/>
<polygon fill="black" stroke="black" points="1977.62,-560.93 1987.62,-557.43 1977.62,-553.93 1977.62,-560.93"/>
<text text-anchor="middle" x="1269" y="-561.23" font-family="Times,serif" font-size="14.00">add_message(user/assistant)</text>
</g>
<!-- ChatProcessor&#45;&gt;SessionMemory -->
<g id="edge14" class="edge">
<title>ChatProcessor&#45;&gt;SessionMemory</title>
<path fill="none" stroke="black" d="M258.18,-335.68C273.2,-369.11 309.72,-440.14 363,-477.43 546.28,-605.7 625.29,-608.43 849,-608.43 849,-608.43 849,-608.43 1752.5,-608.43 1843.51,-608.43 1946.33,-591.76 2017.71,-577.48"/>
<polygon fill="black" stroke="black" points="2018.46,-580.9 2027.57,-575.48 2017.07,-574.03 2018.46,-580.9"/>
<text text-anchor="middle" x="1269" y="-612.23" font-family="Times,serif" font-size="14.00">get_recent_context(token_budget)</text>
</g>
<!-- UserMemory -->
<g id="node6" class="node">
<title>UserMemory</title>
<path fill="none" stroke="black" d="M1334.5,-335.43C1334.5,-335.43 1203.5,-335.43 1203.5,-335.43 1197.5,-335.43 1191.5,-329.43 1191.5,-323.43 1191.5,-323.43 1191.5,-311.43 1191.5,-311.43 1191.5,-305.43 1197.5,-299.43 1203.5,-299.43 1203.5,-299.43 1334.5,-299.43 1334.5,-299.43 1340.5,-299.43 1346.5,-305.43 1346.5,-311.43 1346.5,-311.43 1346.5,-323.43 1346.5,-323.43 1346.5,-329.43 1340.5,-335.43 1334.5,-335.43"/>
<text text-anchor="middle" x="1269" y="-320.63" font-family="Times,serif" font-size="11.00">UserMemory</text>
<text text-anchor="middle" x="1269" y="-308.63" font-family="Times,serif" font-size="11.00">(add/search/consolidate)</text>
</g>
<!-- ChatProcessor&#45;&gt;UserMemory -->
<g id="edge15" class="edge">
<title>ChatProcessor&#45;&gt;UserMemory</title>
<path fill="none" stroke="black" d="M345.31,-317.43C541.99,-317.43 991.8,-317.43 1181.29,-317.43"/>
<polygon fill="black" stroke="black" points="1181.49,-320.93 1191.49,-317.43 1181.49,-313.93 1181.49,-320.93"/>
<text text-anchor="middle" x="850" y="-321.23" font-family="Times,serif" font-size="14.00">get_relevant_memories(context, budget)</text>
</g>
<!-- SystemPrompt -->
<g id="node13" class="node">
<title>SystemPrompt</title>
<path fill="none" stroke="black" d="M901.5,-109.43C901.5,-109.43 798.5,-109.43 798.5,-109.43 792.5,-109.43 786.5,-103.43 786.5,-97.43 786.5,-97.43 786.5,-85.43 786.5,-85.43 786.5,-79.43 792.5,-73.43 798.5,-73.43 798.5,-73.43 901.5,-73.43 901.5,-73.43 907.5,-73.43 913.5,-79.43 913.5,-85.43 913.5,-85.43 913.5,-97.43 913.5,-97.43 913.5,-103.43 907.5,-109.43 901.5,-109.43"/>
<text text-anchor="middle" x="850" y="-94.63" font-family="Times,serif" font-size="11.00">System prompt</text>
<text text-anchor="middle" x="850" y="-82.63" font-family="Times,serif" font-size="11.00">(+ memory header)</text>
</g>
<!-- ChatProcessor&#45;&gt;SystemPrompt -->
<g id="edge18" class="edge">
<title>ChatProcessor&#45;&gt;SystemPrompt</title>
<path fill="none" stroke="black" d="M270.18,-299.25C291.56,-280.37 327.45,-251.17 363,-233.43 501.07,-164.54 678.3,-123.36 776.07,-104.28"/>
<polygon fill="black" stroke="black" points="776.99,-107.66 786.14,-102.33 775.66,-100.79 776.99,-107.66"/>
<text text-anchor="middle" x="525" y="-237.23" font-family="Times,serif" font-size="14.00">compose with memories + history</text>
</g>
<!-- MemoryCompressor -->
<g id="node16" class="node">
<title>MemoryCompressor</title>
<path fill="none" stroke="black" d="M903.5,-262.43C903.5,-262.43 796.5,-262.43 796.5,-262.43 790.5,-262.43 784.5,-256.43 784.5,-250.43 784.5,-250.43 784.5,-238.43 784.5,-238.43 784.5,-232.43 790.5,-226.43 796.5,-226.43 796.5,-226.43 903.5,-226.43 903.5,-226.43 909.5,-226.43 915.5,-232.43 915.5,-238.43 915.5,-238.43 915.5,-250.43 915.5,-250.43 915.5,-256.43 909.5,-262.43 903.5,-262.43"/>
<text text-anchor="middle" x="850" y="-247.63" font-family="Times,serif" font-size="11.00">MemoryCompressor</text>
<text text-anchor="middle" x="850" y="-235.63" font-family="Times,serif" font-size="11.00">(compress/extract)</text>
</g>
<!-- ChatProcessor&#45;&gt;MemoryCompressor -->
<g id="edge21" class="edge">
<title>ChatProcessor&#45;&gt;MemoryCompressor</title>
<path fill="none" stroke="black" d="M313.18,-299.35C329.3,-295.23 346.7,-291.25 363,-288.43 507.38,-263.45 678.49,-252.14 774.32,-247.43"/>
<polygon fill="black" stroke="black" points="774.67,-250.92 784.49,-246.94 774.34,-243.93 774.67,-250.92"/>
<text text-anchor="middle" x="525" y="-292.23" font-family="Times,serif" font-size="14.00">background: extract_memories(conversation)</text>
</g>
<!-- MemOrchestrator -->
<g id="node17" class="node">
<title>MemOrchestrator</title>
<path fill="none" stroke="black" d="M912,-386.43C912,-386.43 788,-386.43 788,-386.43 782,-386.43 776,-380.43 776,-374.43 776,-374.43 776,-362.43 776,-362.43 776,-356.43 782,-350.43 788,-350.43 788,-350.43 912,-350.43 912,-350.43 918,-350.43 924,-356.43 924,-362.43 924,-362.43 924,-374.43 924,-374.43 924,-380.43 918,-386.43 912,-386.43"/>
<text text-anchor="middle" x="850" y="-371.63" font-family="Times,serif" font-size="11.00">MemoryOrchestrator</text>
<text text-anchor="middle" x="850" y="-359.63" font-family="Times,serif" font-size="11.00">(token budget, routers)</text>
</g>
<!-- ChatProcessor&#45;&gt;MemOrchestrator -->
<g id="edge26" class="edge">
<title>ChatProcessor&#45;&gt;MemOrchestrator</title>
<path fill="none" stroke="black" d="M345.3,-329.55C351.28,-330.22 357.22,-330.85 363,-331.43 504.09,-345.57 668.71,-357.05 765.6,-363.29"/>
<polygon fill="black" stroke="black" points="765.42,-366.79 775.63,-363.94 765.87,-359.8 765.42,-366.79"/>
<text text-anchor="middle" x="525" y="-361.23" font-family="Times,serif" font-size="14.00">calculate_token_budget()</text>
</g>
<!-- ConversationStore -->
<g id="node4" class="node">
<title>ConversationStore</title>
<path fill="none" stroke="black" d="M2656.5,-605.43C2656.5,-605.43 2540.5,-605.43 2540.5,-605.43 2534.5,-605.43 2528.5,-599.43 2528.5,-593.43 2528.5,-593.43 2528.5,-581.43 2528.5,-581.43 2528.5,-575.43 2534.5,-569.43 2540.5,-569.43 2540.5,-569.43 2656.5,-569.43 2656.5,-569.43 2662.5,-569.43 2668.5,-575.43 2668.5,-581.43 2668.5,-581.43 2668.5,-593.43 2668.5,-593.43 2668.5,-599.43 2662.5,-605.43 2656.5,-605.43"/>
<text text-anchor="middle" x="2598.5" y="-590.63" font-family="Times,serif" font-size="11.00">ConversationStore</text>
<text text-anchor="middle" x="2598.5" y="-578.63" font-family="Times,serif" font-size="11.00">(persistent convo DB)</text>
</g>
<!-- SessionMemory&#45;&gt;ConversationStore -->
<g id="edge4" class="edge">
<title>SessionMemory&#45;&gt;ConversationStore</title>
<path fill="none" stroke="black" d="M2228.19,-564.75C2318.33,-570.28 2439.6,-577.73 2518.16,-582.56"/>
<polygon fill="black" stroke="black" points="2518.29,-586.07 2528.48,-583.19 2518.71,-579.08 2518.29,-586.07"/>
<text text-anchor="middle" x="2374.5" y="-584.23" font-family="Times,serif" font-size="14.00">append_message / get_conversation</text>
</g>
<!-- EmbeddingGenerator -->
<g id="node5" class="node">
<title>EmbeddingGenerator</title>
<path fill="none" stroke="black" d="M2655,-551.43C2655,-551.43 2542,-551.43 2542,-551.43 2536,-551.43 2530,-545.43 2530,-539.43 2530,-539.43 2530,-527.43 2530,-527.43 2530,-521.43 2536,-515.43 2542,-515.43 2542,-515.43 2655,-515.43 2655,-515.43 2661,-515.43 2667,-521.43 2667,-527.43 2667,-527.43 2667,-539.43 2667,-539.43 2667,-545.43 2661,-551.43 2655,-551.43"/>
<text text-anchor="middle" x="2598.5" y="-530.63" font-family="Times,serif" font-size="11.00">EmbeddingGenerator</text>
</g>
<!-- SessionMemory&#45;&gt;EmbeddingGenerator -->
<g id="edge3" class="edge">
<title>SessionMemory&#45;&gt;EmbeddingGenerator</title>
<path fill="none" stroke="black" d="M2228.16,-547.55C2234.19,-547.15 2240.16,-546.77 2246,-546.43 2339.98,-540.92 2448.25,-537.33 2519.51,-535.35"/>
<polygon fill="black" stroke="black" points="2519.85,-538.84 2529.75,-535.07 2519.65,-531.84 2519.85,-538.84"/>
<text text-anchor="middle" x="2374.5" y="-550.23" font-family="Times,serif" font-size="14.00">gen msg embeddings?</text>
</g>
<!-- MemoryStore -->
<g id="node7" class="node">
<title>MemoryStore</title>
<path fill="none" stroke="black" d="M1825,-335.43C1825,-335.43 1678,-335.43 1678,-335.43 1672,-335.43 1666,-329.43 1666,-323.43 1666,-323.43 1666,-311.43 1666,-311.43 1666,-305.43 1672,-299.43 1678,-299.43 1678,-299.43 1825,-299.43 1825,-299.43 1831,-299.43 1837,-305.43 1837,-311.43 1837,-311.43 1837,-323.43 1837,-323.43 1837,-329.43 1831,-335.43 1825,-335.43"/>
<text text-anchor="middle" x="1751.5" y="-320.63" font-family="Times,serif" font-size="11.00">MemoryStore</text>
<text text-anchor="middle" x="1751.5" y="-308.63" font-family="Times,serif" font-size="11.00">(persistent user memories)</text>
</g>
<!-- UserMemory&#45;&gt;MemoryStore -->
<g id="edge5" class="edge">
<title>UserMemory&#45;&gt;MemoryStore</title>
<path fill="none" stroke="black" d="M1346.67,-317.43C1430.48,-317.43 1564.86,-317.43 1655.35,-317.43"/>
<polygon fill="black" stroke="black" points="1655.61,-320.93 1665.61,-317.43 1655.61,-313.93 1655.61,-320.93"/>
<text text-anchor="middle" x="1526.5" y="-321.23" font-family="Times,serif" font-size="14.00">save/get/update</text>
</g>
<!-- HybridRetriever -->
<g id="node8" class="node">
<title>HybridRetriever</title>
<path fill="none" stroke="black" d="M1823,-416.43C1823,-416.43 1680,-416.43 1680,-416.43 1674,-416.43 1668,-410.43 1668,-404.43 1668,-404.43 1668,-392.43 1668,-392.43 1668,-386.43 1674,-380.43 1680,-380.43 1680,-380.43 1823,-380.43 1823,-380.43 1829,-380.43 1835,-386.43 1835,-392.43 1835,-392.43 1835,-404.43 1835,-404.43 1835,-410.43 1829,-416.43 1823,-416.43"/>
<text text-anchor="middle" x="1751.5" y="-401.63" font-family="Times,serif" font-size="11.00">HybridRetriever</text>
<text text-anchor="middle" x="1751.5" y="-389.63" font-family="Times,serif" font-size="11.00">(intent → RRF + temporal)</text>
</g>
<!-- UserMemory&#45;&gt;HybridRetriever -->
<g id="edge16" class="edge">
<title>UserMemory&#45;&gt;HybridRetriever</title>
<path fill="none" stroke="black" d="M1346.81,-326.51C1367.03,-328.83 1388.83,-331.28 1409,-333.43 1513.35,-344.54 1546.18,-318.43 1644,-356.43 1652.29,-359.65 1652.12,-364.31 1660,-368.43 1665.58,-371.35 1671.51,-374.06 1677.55,-376.57"/>
<polygon fill="black" stroke="black" points="1676.51,-379.92 1687.1,-380.33 1679.08,-373.41 1676.51,-379.92"/>
<text text-anchor="middle" x="1526.5" y="-360.23" font-family="Times,serif" font-size="14.00">search_memories(query, user_id)</text>
</g>
<!-- UserMemory&#45;&gt;HybridRetriever -->
<g id="edge23" class="edge">
<title>UserMemory&#45;&gt;HybridRetriever</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1289.24,-335.62C1314.44,-358.06 1361.06,-395 1409,-409.43 1490.48,-433.95 1587.87,-427.54 1657.76,-417.16"/>
<polygon fill="black" stroke="black" points="1658.51,-420.58 1667.86,-415.6 1657.45,-413.66 1658.51,-420.58"/>
<text text-anchor="middle" x="1526.5" y="-429.23" font-family="Times,serif" font-size="14.00">add_memory_to_indices</text>
</g>
<!-- Tantivy -->
<g id="node9" class="node">
<title>Tantivy</title>
<path fill="none" stroke="black" d="M2163.5,-416.43C2163.5,-416.43 2052.5,-416.43 2052.5,-416.43 2046.5,-416.43 2040.5,-410.43 2040.5,-404.43 2040.5,-404.43 2040.5,-392.43 2040.5,-392.43 2040.5,-386.43 2046.5,-380.43 2052.5,-380.43 2052.5,-380.43 2163.5,-380.43 2163.5,-380.43 2169.5,-380.43 2175.5,-386.43 2175.5,-392.43 2175.5,-392.43 2175.5,-404.43 2175.5,-404.43 2175.5,-410.43 2169.5,-416.43 2163.5,-416.43"/>
<text text-anchor="middle" x="2108" y="-401.63" font-family="Times,serif" font-size="11.00">TantivySearchEngine</text>
<text text-anchor="middle" x="2108" y="-389.63" font-family="Times,serif" font-size="11.00">(lexical)</text>
</g>
<!-- UserMemory&#45;&gt;Tantivy -->
<g id="edge25" class="edge">
<title>UserMemory&#45;&gt;Tantivy</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1300.56,-299.35C1327.97,-284.08 1369.79,-263.04 1409,-252.43 1596.3,-201.72 1651.76,-211.8 1845,-229.43 1901.25,-234.56 1920.42,-225.37 1970,-252.43 2022.94,-281.32 2067.04,-338.11 2089.98,-371.71"/>
<polygon fill="black" stroke="black" points="2087.14,-373.76 2095.61,-380.13 2092.96,-369.87 2087.14,-373.76"/>
<text text-anchor="middle" x="1751.5" y="-233.23" font-family="Times,serif" font-size="14.00">add (lexical doc)</text>
</g>
<!-- VectorStore -->
<g id="node10" class="node">
<title>VectorStore</title>
<path fill="none" stroke="black" d="M2199,-470.43C2199,-470.43 2017,-470.43 2017,-470.43 2011,-470.43 2005,-464.43 2005,-458.43 2005,-458.43 2005,-446.43 2005,-446.43 2005,-440.43 2011,-434.43 2017,-434.43 2017,-434.43 2199,-434.43 2199,-434.43 2205,-434.43 2211,-440.43 2211,-446.43 2211,-446.43 2211,-458.43 2211,-458.43 2211,-464.43 2205,-470.43 2199,-470.43"/>
<text text-anchor="middle" x="2108" y="-455.63" font-family="Times,serif" font-size="11.00">VectorMemoryStore</text>
<text text-anchor="middle" x="2108" y="-443.63" font-family="Times,serif" font-size="11.00">(FAISSVectorStore / embeddings)</text>
</g>
<!-- UserMemory&#45;&gt;VectorStore -->
<g id="edge24" class="edge">
<title>UserMemory&#45;&gt;VectorStore</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M1346.54,-303.59C1481.66,-280.52 1756.54,-240.05 1845,-275.43 1916.22,-303.91 1929.19,-329.48 1970,-394.43 1977.7,-406.69 1969.25,-415.73 1980,-425.43 1984.78,-429.74 1990.07,-433.42 1995.7,-436.57"/>
<polygon fill="black" stroke="black" points="1994.29,-439.78 2004.8,-441.08 1997.4,-433.5 1994.29,-439.78"/>
<text text-anchor="middle" x="1751.5" y="-279.23" font-family="Times,serif" font-size="14.00">add (embedding)</text>
</g>
<!-- HybridRetriever&#45;&gt;UserMemory -->
<g id="edge17" class="edge">
<title>HybridRetriever&#45;&gt;UserMemory</title>
<path fill="none" stroke="black" d="M1667.92,-394.66C1582.94,-390.29 1456.47,-382.28 1409,-371.43 1377.42,-364.21 1343.5,-351.14 1317.08,-339.67"/>
<polygon fill="black" stroke="black" points="1318.26,-336.37 1307.7,-335.54 1315.43,-342.78 1318.26,-336.37"/>
<text text-anchor="middle" x="1526.5" y="-396.23" font-family="Times,serif" font-size="14.00">ranked results</text>
</g>
<!-- HybridRetriever&#45;&gt;Tantivy -->
<g id="edge6" class="edge">
<title>HybridRetriever&#45;&gt;Tantivy</title>
<path fill="none" stroke="black" d="M1835.17,-398.43C1894.03,-398.43 1972.58,-398.43 2030.1,-398.43"/>
<polygon fill="black" stroke="black" points="2030.23,-401.93 2040.23,-398.43 2030.23,-394.93 2030.23,-401.93"/>
<text text-anchor="middle" x="1914.5" y="-402.23" font-family="Times,serif" font-size="14.00">lexical query</text>
</g>
<!-- HybridRetriever&#45;&gt;VectorStore -->
<g id="edge7" class="edge">
<title>HybridRetriever&#45;&gt;VectorStore</title>
<path fill="none" stroke="black" d="M1835.01,-413.45C1843.11,-414.84 1851.21,-416.18 1859,-417.43 1903.32,-424.51 1952.22,-431.57 1994.8,-437.47"/>
<polygon fill="black" stroke="black" points="1994.53,-440.97 2004.92,-438.87 1995.49,-434.03 1994.53,-440.97"/>
<text text-anchor="middle" x="1914.5" y="-437.23" font-family="Times,serif" font-size="14.00">semantic query</text>
</g>
<!-- TantivyIdx -->
<g id="node12" class="node">
<title>TantivyIdx</title>
<path fill="none" stroke="black" d="M2632,-106.43C2632,-106.43 2565,-106.43 2565,-106.43 2559,-106.43 2553,-100.43 2553,-94.43 2553,-94.43 2553,-82.43 2553,-82.43 2553,-76.43 2559,-70.43 2565,-70.43 2565,-70.43 2632,-70.43 2632,-70.43 2638,-70.43 2644,-76.43 2644,-82.43 2644,-82.43 2644,-94.43 2644,-94.43 2644,-100.43 2638,-106.43 2632,-106.43"/>
<text text-anchor="middle" x="2598.5" y="-85.63" font-family="Times,serif" font-size="11.00">Tantivy index</text>
</g>
<!-- Tantivy&#45;&gt;TantivyIdx -->
<g id="edge10" class="edge">
<title>Tantivy&#45;&gt;TantivyIdx</title>
<path fill="none" stroke="black" d="M2118.16,-380.35C2137.22,-344.43 2184.54,-263.56 2246,-217.43 2337.48,-148.76 2469.28,-113.54 2542.75,-98.23"/>
<polygon fill="black" stroke="black" points="2543.62,-101.63 2552.72,-96.2 2542.22,-94.77 2543.62,-101.63"/>
<text text-anchor="middle" x="2374.5" y="-221.23" font-family="Times,serif" font-size="14.00">add/search</text>
</g>
<!-- VectorStore&#45;&gt;EmbeddingGenerator -->
<g id="edge8" class="edge">
<title>VectorStore&#45;&gt;EmbeddingGenerator</title>
<path fill="none" stroke="black" d="M2211.12,-468.53C2290.71,-481.19 2403.96,-499.48 2503,-516.43 2508.44,-517.36 2514.06,-518.33 2519.71,-519.33"/>
<polygon fill="black" stroke="black" points="2519.45,-522.83 2529.9,-521.12 2520.66,-515.94 2519.45,-522.83"/>
<text text-anchor="middle" x="2374.5" y="-520.23" font-family="Times,serif" font-size="14.00">embed(query/memory)</text>
</g>
<!-- FAISS -->
<g id="node11" class="node">
<title>FAISS</title>
<path fill="none" stroke="black" d="M2664,-160.43C2664,-160.43 2533,-160.43 2533,-160.43 2527,-160.43 2521,-154.43 2521,-148.43 2521,-148.43 2521,-136.43 2521,-136.43 2521,-130.43 2527,-124.43 2533,-124.43 2533,-124.43 2664,-124.43 2664,-124.43 2670,-124.43 2676,-130.43 2676,-136.43 2676,-136.43 2676,-148.43 2676,-148.43 2676,-154.43 2670,-160.43 2664,-160.43"/>
<text text-anchor="middle" x="2598.5" y="-139.63" font-family="Times,serif" font-size="11.00">FAISS index + metadata</text>
</g>
<!-- VectorStore&#45;&gt;FAISS -->
<g id="edge9" class="edge">
<title>VectorStore&#45;&gt;FAISS</title>
<path fill="none" stroke="black" d="M2205.37,-434.36C2213.17,-431.76 2220.81,-428.8 2228,-425.43 2373.69,-357.13 2516.3,-223.85 2572.47,-168.01"/>
<polygon fill="black" stroke="black" points="2575.22,-170.2 2579.81,-160.66 2570.27,-165.26 2575.22,-170.2"/>
<text text-anchor="middle" x="2374.5" y="-417.23" font-family="Times,serif" font-size="14.00">add/search</text>
</g>
<!-- LLM -->
<g id="node14" class="node">
<title>LLM</title>
<path fill="none" stroke="black" d="M1351,-87.43C1351,-87.43 1187,-87.43 1187,-87.43 1181,-87.43 1175,-81.43 1175,-75.43 1175,-75.43 1175,-63.43 1175,-63.43 1175,-57.43 1181,-51.43 1187,-51.43 1187,-51.43 1351,-51.43 1351,-51.43 1357,-51.43 1363,-57.43 1363,-63.43 1363,-63.43 1363,-75.43 1363,-75.43 1363,-81.43 1357,-87.43 1351,-87.43"/>
<text text-anchor="middle" x="1269" y="-72.63" font-family="Times,serif" font-size="11.00">OptimizedChatClient / OpenAI</text>
<text text-anchor="middle" x="1269" y="-60.63" font-family="Times,serif" font-size="11.00">(tool calling)</text>
</g>
<!-- SystemPrompt&#45;&gt;LLM -->
<g id="edge19" class="edge">
<title>SystemPrompt&#45;&gt;LLM</title>
<path fill="none" stroke="black" d="M913.88,-88.11C980.19,-84.61 1085.73,-79.04 1164.37,-74.89"/>
<polygon fill="black" stroke="black" points="1164.99,-78.37 1174.79,-74.34 1164.62,-71.38 1164.99,-78.37"/>
<text text-anchor="middle" x="1071" y="-85.23" font-family="Times,serif" font-size="14.00">messages[]</text>
</g>
<!-- LLM&#45;&gt;ChatProcessor -->
<g id="edge20" class="edge">
<title>LLM&#45;&gt;ChatProcessor</title>
<path fill="none" stroke="black" d="M1202.71,-51.38C1042.16,-11.19 622.4,68.04 363,-120.43 304.3,-163.08 271.82,-246.37 258.23,-289.71"/>
<polygon fill="black" stroke="black" points="254.86,-288.74 255.32,-299.33 261.56,-290.77 254.86,-288.74"/>
<text text-anchor="middle" x="850" y="-15.23" font-family="Times,serif" font-size="14.00">assistant response (+/− tools)</text>
</g>
<!-- Tools -->
<g id="node15" class="node">
<title>Tools</title>
<path fill="none" stroke="black" d="M1785.5,-91.43C1785.5,-91.43 1717.5,-91.43 1717.5,-91.43 1711.5,-91.43 1705.5,-85.43 1705.5,-79.43 1705.5,-79.43 1705.5,-67.43 1705.5,-67.43 1705.5,-61.43 1711.5,-55.43 1717.5,-55.43 1717.5,-55.43 1785.5,-55.43 1785.5,-55.43 1791.5,-55.43 1797.5,-61.43 1797.5,-67.43 1797.5,-67.43 1797.5,-79.43 1797.5,-79.43 1797.5,-85.43 1791.5,-91.43 1785.5,-91.43"/>
<text text-anchor="middle" x="1751.5" y="-76.63" font-family="Times,serif" font-size="11.00">tool_executor</text>
<text text-anchor="middle" x="1751.5" y="-64.63" font-family="Times,serif" font-size="11.00">(functions)</text>
</g>
<!-- LLM&#45;&gt;Tools -->
<g id="edge11" class="edge">
<title>LLM&#45;&gt;Tools</title>
<path fill="none" stroke="black" d="M1363.02,-60.28C1378.36,-59.09 1394.12,-58.07 1409,-57.43 1513.35,-52.93 1539.85,-49.65 1644,-57.43 1660.75,-58.68 1678.87,-61.02 1695.32,-63.54"/>
<polygon fill="black" stroke="black" points="1694.9,-67.02 1705.32,-65.12 1695.99,-60.1 1694.9,-67.02"/>
<text text-anchor="middle" x="1526.5" y="-61.23" font-family="Times,serif" font-size="14.00">tool calls</text>
</g>
<!-- Tools&#45;&gt;LLM -->
<g id="edge12" class="edge">
<title>Tools&#45;&gt;LLM</title>
<path fill="none" stroke="black" d="M1705.47,-73.56C1640.15,-73.7 1515.27,-73.73 1409,-72.43 1397.4,-72.29 1385.26,-72.09 1373.19,-71.87"/>
<polygon fill="black" stroke="black" points="1373.15,-68.37 1363.08,-71.68 1373.01,-75.37 1373.15,-68.37"/>
<text text-anchor="middle" x="1526.5" y="-77.23" font-family="Times,serif" font-size="14.00">tool results</text>
</g>
<!-- MemoryCompressor&#45;&gt;EmbeddingGenerator -->
<g id="edge13" class="edge">
<title>MemoryCompressor&#45;&gt;EmbeddingGenerator</title>
<path fill="none" stroke="black" stroke-dasharray="5,2" d="M908.01,-226.37C987.71,-202.78 1137.34,-164.43 1268,-164.43 1268,-164.43 1268,-164.43 2109,-164.43 2336.4,-164.43 2524.91,-422.17 2580.7,-506.84"/>
<polygon fill="black" stroke="black" points="2577.87,-508.91 2586.26,-515.38 2583.74,-505.09 2577.87,-508.91"/>
<text text-anchor="middle" x="1751.5" y="-168.23" font-family="Times,serif" font-size="14.00">embed compressed text?</text>
</g>
<!-- MemoryCompressor&#45;&gt;UserMemory -->
<g id="edge22" class="edge">
<title>MemoryCompressor&#45;&gt;UserMemory</title>
<path fill="none" stroke="black" d="M915.75,-253.76C972.19,-262.12 1056.18,-275.08 1129,-288.43 1145.92,-291.53 1163.95,-295.1 1181.23,-298.64"/>
<polygon fill="black" stroke="black" points="1180.79,-302.13 1191.3,-300.73 1182.21,-295.27 1180.79,-302.13"/>
<text text-anchor="middle" x="1071" y="-292.23" font-family="Times,serif" font-size="14.00">add_memory(...)</text>
</g>
<!-- MemOrchestrator&#45;&gt;SessionMemory -->
<g id="edge27" class="edge">
<title>MemOrchestrator&#45;&gt;SessionMemory</title>
<path fill="none" stroke="black" d="M924.17,-381.78C1065.88,-407.37 1387.8,-464.29 1660,-503.43 1766.72,-518.77 1888.21,-533.26 1977.57,-543.35"/>
<polygon fill="black" stroke="black" points="1977.42,-546.86 1987.75,-544.5 1978.21,-539.9 1977.42,-546.86"/>
</g>
<!-- MemOrchestrator&#45;&gt;UserMemory -->
<g id="edge28" class="edge">
<title>MemOrchestrator&#45;&gt;UserMemory</title>
<path fill="none" stroke="black" d="M924.11,-359.49C995.87,-350.71 1105.32,-337.32 1181.4,-328.02"/>
<polygon fill="black" stroke="black" points="1181.94,-331.48 1191.44,-326.79 1181.09,-324.53 1181.94,-331.48"/>
</g>
</g>
</svg>
